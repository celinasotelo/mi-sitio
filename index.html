<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mi página con JS</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; max-width:900px; margin:2rem auto; padding:0 1rem; }
    textarea { width:100%; height:200px; font-family: monospace; margin-top:0.5rem; }
    .controls { display:flex; gap:.5rem; margin-top:.5rem; }
    iframe { width:100%; height:320px; border:1px solid #ddd; margin-top:1rem; }
    .note { color:#666; font-size:.9rem; margin-top:.5rem; }
  </style>
</head>
<body>
  <h1>Mi sitio — probar JavaScript</h1>

  <h2>1) Incluir script externo (archivo <code>script.js</code>)</h2>
  <p>Si colocás un archivo <code>script.js</code> en el mismo directorio, se cargará automáticamente:</p>
  <p><em>Archivo externo:</em> <code>&lt;script src="script.js" defer&gt;&lt;/script&gt;</code></p>

  <h2>2) Pegar JS y ejecutarlo en un <code>iframe</code> sandbox (recomendado)</h2>
  <p>Pega tu JavaScript abajo y presiona <strong>Ejecutar en sandbox</strong>. El script correrá dentro de un iframe aislado.</p>
  <textarea id="userjs" placeholder="// Pega aquí tu JS. Por ejemplo: console.log('hola');"></textarea>
  <div class="controls">
    <button id="runSandbox">Ejecutar en sandbox</button>
    <button id="runTop">Ejecutar en la página (NO recomendado)</button>
    <label style="margin-left:auto">
      <input type="checkbox" id="allowForms"> permitir forms/navigation en sandbox
    </label>
  </div>
  <div class="note">Ejecutar en la página puede afectar a la web; usar sandbox para mayor seguridad.</div>

  <iframe id="sandbox" sandbox="allow-scripts" srcdoc="<p>Sandbox listo</p>"></iframe>

  <h2>3) Consola del iframe</h2>
  <p class="note">Los <code>console.log</code> del iframe no aparecen en la consola del navegador principal. Poné <code>document.body.innerText = '...' </code> para ver salidas dentro del iframe.</p>

  <script>
    const runSandboxBtn = document.getElementById('runSandbox');
    const runTopBtn = document.getElementById('runTop');
    const userjs = document.getElementById('userjs');
    const iframe = document.getElementById('sandbox');
    runSandboxBtn.addEventListener('click', () => {
      const allowForms = document.getElementById('allowForms').checked;
      // Build the iframe srcdoc with the user JS
      const src = `
        <!doctype html><html><head><meta charset="utf-8"><title>Sandbox</title></head>
        <body>
          <div id="out">Sandbox iniciado</div>
          <script>
            try {
              // Aquí se ejecuta el JS del usuario
              ${userjs.value}
            } catch(e) {
              document.getElementById('out').innerText = 'Error: ' + e;
            }
          <\/script>
        </body></html>
      `;
      // Recreate iframe with appropriate sandbox flags
      const sandboxFlags = ['allow-scripts'];
      if (allowForms) sandboxFlags.push('allow-forms', 'allow-top-navigation-by-user-activation');
      iframe.setAttribute('sandbox', sandboxFlags.join(' '));
      iframe.srcdoc = src;
    });

    runTopBtn.addEventListener('click', () => {
      // Ejecuta en el contexto principal — peligroso si no confías en el código
      try {
        new Function(userjs.value)();
      } catch(e) {
        alert('Error: ' + e);
      }
    });
  </script>

  <!-- Carga opcional de script.js si existe -->
  <script src="script.js" defer></script>
</body>
</html>
